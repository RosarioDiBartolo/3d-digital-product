import{f as A}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{T as B,a as N}from"./chunk-MSDRGCRR-B_eEYFdA.js";import{a5 as O,ah as I,a7 as K,U as Q,b6 as U,j as t,b,ac as V,ad as $,r as f,ev as G,ey as J,t as S,B as P,J as j,k as Z}from"./index-C9AxsCP1.js";import{u as W,_ as X}from"./chunk-X3LH6P65-Y6KqbLuV.js";import"./lodash-qeP2Cq9C.js";import{u as Y}from"./chunk-W7625H47-BwmLixBL.js";import"./chunk-TMAS4ILY-vha135_I.js";import{u as ee}from"./chunk-C76H5USB-B09sCTl4.js";import{K as te}from"./chunk-6HTZNHPT-BkGNcgHF.js";import{R as n,u as se}from"./chunk-JGQGO74V-BufRAs73.js";import{c as _}from"./index-BonVgKHu.js";import"./chunk-P3UUX2T6-BO8T--Us.js";import"./chunk-YEDAFXMB-C6olEUb_.js";import"./chunk-AOFGTNG6-C3gmN2tf.js";import"./descending-sorting-Du9ZFhNM.js";import"./chunk-WX2SMNCD-BIanU_iF.js";import"./plus-mini-C06hGw0G.js";import"./chunk-DV5RB7II-36VZtDop.js";import"./format-DXYNQCFP.js";import"./_isIndex-jBi_gNPs.js";import"./x-mark-mini-Dajb-hIL.js";import"./date-picker-C7YMFRvh.js";import"./popover-DXYnWrLm.js";import"./triangle-left-mini-DXs3sR5o.js";import"./index-BFr4LIRT.js";import"./prompt-klaj1z2V.js";var oe=_(),re=()=>{const{t:s}=b();return f.useMemo(()=>[oe.accessor("id",{header:()=>t.jsx(B,{text:"Provider"}),cell:({getValue:e})=>t.jsx(N,{text:A(e())})})],[s])},ae=({prefix:s,pageSize:e=20})=>{const o=ee(["offset","q","stock_location_id"],s),{offset:l,q:c,stock_location_id:u}=o;return{searchParams:{limit:e,offset:l?Number(l):0,stock_location_id:u,q:c},raw:o}},ie=O({fulfillment_providers:I(K()).optional()}),d=50,le=({location:s})=>{var v,x;const{t:e}=b(),{handleSuccess:o}=se(),l=V({defaultValues:{fulfillment_providers:((v=s.fulfillment_providers)==null?void 0:v.map(r=>r.id))??[]},resolver:$(ie)}),{setValue:c}=l,u=((x=s.fulfillment_providers)==null?void 0:x.reduce((r,a)=>(r[a.id]=!0,r),{}))??{},[m,k]=f.useState(u),F=r=>{const a=typeof r=="function"?r(m):r;c("fulfillment_providers",Object.keys(a),{shouldDirty:!0,shouldTouch:!0}),k(a)},{searchParams:w,raw:C}=ae({pageSize:d}),{fulfillment_providers:T,count:p,isLoading:R,isError:E,error:L}=G({...w,is_enabled:!0},{placeholderData:Z}),z=Y(),h=ce(),{table:D}=W({data:T??[],columns:h,count:p,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:m,updater:F},getRowId:r=>r.id,pageSize:d}),{mutateAsync:H,isPending:M}=J(s.id),q=l.handleSubmit(async r=>{var y;const a=(y=s.fulfillment_providers)==null?void 0:y.map(i=>i.id),g=r.fulfillment_providers??[];await H({add:g.filter(i=>!(a!=null&&a.includes(i))),remove:a==null?void 0:a.filter(i=>!g.includes(i))},{onSuccess:({stock_location:i})=>{S.success(e("stockLocations.fulfillmentProviders.successToast")),o(`/settings/locations/${i.id}`)},onError:i=>{S.error(i.message)}})});if(E)throw L;return t.jsx(n.Form,{form:l,children:t.jsxs(te,{onSubmit:q,className:"flex size-full flex-col",children:[t.jsx(n.Header,{}),t.jsx(n.Body,{className:"flex flex-1 flex-col overflow-auto",children:t.jsx(X,{table:D,columns:h,pageSize:d,isLoading:R,count:p,filters:z,search:"autofocus",pagination:!0,orderBy:[{key:"id",label:e("fields.id")}],queryObject:C,layout:"fill"})}),t.jsx(n.Footer,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[t.jsx(n.Close,{asChild:!0,children:t.jsx(P,{size:"small",variant:"secondary",type:"button",children:e("actions.cancel")})}),t.jsx(P,{size:"small",isLoading:M,type:"submit",children:e("actions.save")})]})})]})})},ne=_(),ce=()=>{const s=re();return f.useMemo(()=>[ne.display({id:"select",header:({table:e})=>t.jsx(j,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:o=>e.toggleAllPageRowsSelected(!!o)}),cell:({row:e})=>t.jsx(j,{checked:e.getIsSelected(),onCheckedChange:o=>e.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}})}),...s],[s])},Me=()=>{const{location_id:s}=Q(),{stock_location:e,isPending:o,isError:l,error:c}=U(s,{fields:"id,*fulfillment_providers"}),u=!o&&!!e;if(l)throw c;return t.jsx(n,{children:u&&t.jsx(le,{location:e})})};export{Me as Component};
