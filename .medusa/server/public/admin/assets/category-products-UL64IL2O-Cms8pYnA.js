import{u as I}from"./chunk-G3QXMPRB-C9vXn9rk.js";import{aa as u,U as A,aV as B,j as t,b as P,r as S,ac as H,ad as M,e as D,aW as N,t as f,G as V,B as x,J as y,Y as G}from"./index-C9AxsCP1.js";import{u as K,_ as L}from"./chunk-X3LH6P65-Y6KqbLuV.js";import"./lodash-qeP2Cq9C.js";import{u as O,a as U}from"./chunk-U6CSGYH6-B6506LSP.js";import"./chunk-TMAS4ILY-vha135_I.js";import{K as q}from"./chunk-6HTZNHPT-BkGNcgHF.js";import{R as l,u as J}from"./chunk-JGQGO74V-BufRAs73.js";import{c as Q}from"./index-BonVgKHu.js";import"./chunk-IQBAUTU5-Bq0ICSBD.js";import"./chunk-ADOCJB6L-DEaMi7KC.js";import"./chunk-P3UUX2T6-BO8T--Us.js";import"./chunk-YEDAFXMB-C6olEUb_.js";import"./chunk-AOFGTNG6-C3gmN2tf.js";import"./descending-sorting-Du9ZFhNM.js";import"./chunk-WX2SMNCD-BIanU_iF.js";import"./plus-mini-C06hGw0G.js";import"./chunk-C76H5USB-B09sCTl4.js";import"./chunk-DV5RB7II-36VZtDop.js";import"./format-DXYNQCFP.js";import"./_isIndex-jBi_gNPs.js";import"./x-mark-mini-Dajb-hIL.js";import"./date-picker-C7YMFRvh.js";import"./popover-DXYnWrLm.js";import"./triangle-left-mini-DXs3sR5o.js";import"./index-BFr4LIRT.js";import"./prompt-klaj1z2V.js";var W=u.object({product_ids:u.array(u.string())}),m=50,p="p",X=({categoryId:c,products:o=[]})=>{const{t:e}=P(),{handleSuccess:a}=J(),[d,n]=S.useState(o.reduce((s,i)=>(s[i.id]=!0,s),{})),r=H({defaultValues:{product_ids:[]},resolver:M(W)}),b=s=>{const i=typeof s=="function"?s(d):s;r.setValue("product_ids",Object.keys(i),{shouldDirty:!0,shouldTouch:!0}),n(i)},{searchParams:j,raw:C}=O({pageSize:m,prefix:p}),{products:v,count:g,isPending:_,isError:k,error:E}=D({...j}),h=Z(),R=U(["categories"]),{table:T}=K({data:v,columns:h,getRowId:s=>s.id,count:g,pageSize:m,prefix:p,enableRowSelection:s=>!o.some(i=>i.id===s.original.id),enablePagination:!0,rowSelection:{state:d,updater:b}}),{mutateAsync:w,isPending:F}=N(c),z=r.handleSubmit(async s=>{await w({add:s.product_ids},{onSuccess:()=>{f.success(e("categories.products.add.successToast",{count:s.product_ids.length-o.length})),a()},onError:i=>{f.error(i.message)}})});if(k)throw E;return t.jsx(l.Form,{form:r,children:t.jsxs(q,{onSubmit:z,className:"flex h-full flex-col overflow-hidden",children:[t.jsx(l.Header,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.formState.errors.product_ids&&t.jsx(V,{variant:"error",children:r.formState.errors.product_ids.message}),t.jsx(l.Close,{asChild:!0,children:t.jsx(x,{size:"small",variant:"secondary",children:e("actions.cancel")})}),t.jsx(x,{size:"small",type:"submit",isLoading:F,children:e("actions.save")})]})}),t.jsx(l.Body,{className:"size-full overflow-hidden",children:t.jsx(L,{table:T,columns:h,pageSize:m,count:g,queryObject:C,filters:R,orderBy:[{key:"title",label:e("fields.title")},{key:"created_at",label:e("fields.createdAt")},{key:"updated_at",label:e("fields.updatedAt")}],prefix:p,isLoading:_,layout:"fill",pagination:!0,search:"autofocus"})})]})})},Y=Q(),Z=()=>{const{t:c}=P(),o=I();return S.useMemo(()=>[Y.display({id:"select",header:({table:e})=>t.jsx(y,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:a=>e.toggleAllPageRowsSelected(!!a)}),cell:({row:e})=>{const a=!e.getCanSelect(),d=e.getIsSelected()||a,n=t.jsx(y,{checked:d,disabled:a,onCheckedChange:r=>e.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}});return a?t.jsx(G,{content:c("categories.products.add.disabledTooltip"),side:"right",children:n}):n}}),...o],[c,o])},ke=()=>{const{id:c}=A(),{product_category:o,isPending:e,isFetching:a,isError:d,error:n}=B(c,{fields:"products.id"}),r=!e&&!a&&!!o;if(d)throw n;return t.jsx(l,{children:r&&t.jsx(X,{categoryId:o.id,products:o.products})})};export{ke as Component};
