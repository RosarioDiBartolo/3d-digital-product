import{C as B}from"./chunk-4UY4U2B5-9iVkkaFg.js";import{i as $}from"./chunk-54IEHX46-DWMq7yL7.js";import{H as A}from"./chunk-7OYLCEKK-CZFdgF2E.js";import{aa as c,a3 as K,j as e,b as M,r as j,ac as W,ad as q,aP as G,t as H,B as V,H as J,T as O,w as s,x as Q,a9 as i,ak as U,v as P,$ as X}from"./index-C9AxsCP1.js";import{t as Y}from"./chunk-3ISBJK7K-BPFEXhG7.js";import{K as Z}from"./chunk-6HTZNHPT-BkGNcgHF.js";import{R as x,u as ee}from"./chunk-JGQGO74V-BufRAs73.js";import{P as m}from"./progress-tabs-1QCbNip9.js";import{T as se}from"./textarea-kUTTdGqA.js";import"./sortable.esm-BOf1IuHe.js";import"./dots-six-B9RO5LGk.js";import"./folder-illustration-C7KroGEI.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./prompt-klaj1z2V.js";var ae=({form:t})=>{const{t:a}=M();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(J,{children:a("categories.create.header")}),e.jsx(O,{size:"small",className:"text-ui-fg-subtle",children:a("categories.create.hint")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"name",render:({field:r})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("fields.title")}),e.jsx(s.Control,{children:e.jsx(Q,{autoComplete:"off",...r})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"handle",render:({field:r})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,tooltip:a("collections.handleTooltip"),children:a("fields.handle")}),e.jsx(s.Control,{children:e.jsx(A,{...r})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(s.Field,{control:t.control,name:"description",render:({field:r})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:a("fields.description")}),e.jsx(s.Control,{children:e.jsx(se,{...r})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"status",render:({field:{ref:r,onChange:o,...d}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("categories.fields.status.label")}),e.jsx(s.Control,{children:e.jsxs(i,{...d,onValueChange:o,children:[e.jsx(i.Trigger,{ref:r,children:e.jsx(i.Value,{})}),e.jsxs(i.Content,{children:[e.jsx(i.Item,{value:"active",children:a("categories.fields.status.active")}),e.jsx(i.Item,{value:"inactive",children:a("categories.fields.status.inactive")})]})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"visibility",render:({field:{ref:r,onChange:o,...d}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("categories.fields.visibility.label")}),e.jsx(s.Control,{children:e.jsxs(i,{...d,onValueChange:o,children:[e.jsx(i.Trigger,{ref:r,children:e.jsx(i.Value,{})}),e.jsxs(i.Content,{children:[e.jsx(i.Item,{value:"public",children:a("categories.fields.visibility.public")}),e.jsx(i.Item,{value:"internal",children:a("categories.fields.visibility.internal")})]})]})}),e.jsx(s.ErrorMessage,{})]})})]})]})})},L="new-item",te=({form:t,shouldFreeze:a})=>{const{t:r}=M(),[o,d]=j.useState([]),{product_categories:g,isPending:w,isError:N,error:p}=U({parent_category_id:"null",limit:9999,fields:"id,name,parent_category_id,rank,category_children,rank",include_descendants_tree:!0}),n=P({control:t.control,name:"parent_category_id"}),h=P({control:t.control,name:"rank"}),f=P({control:t.control,name:"name"}),S=j.useMemo(()=>$(g??[],{id:L,name:f,parent_category_id:n,rank:h,category_children:null}),[g,f,n,h]),T=({parentId:l,index:v},b)=>{t.setValue("parent_category_id",l,{shouldDirty:!0,shouldTouch:!0}),t.setValue("rank",v,{shouldDirty:!0,shouldTouch:!0}),d(b)};if(N)throw p;const z=!w&&!!g;return e.jsx(B,{value:a?o:S,enableDrag:l=>l.id===L,onChange:T,renderValue:l=>l.id===L?e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("span",{children:l.name}),e.jsx(X,{size:"2xsmall",color:"blue",children:r("categories.fields.new.label")})]}):l.name,isLoading:!z})},R=c.object({name:c.string().min(1),description:c.string().optional(),handle:c.string().optional(),status:c.enum(["active","inactive"]),visibility:c.enum(["public","internal"])}),re=c.object({rank:c.number().nullable(),parent_category_id:c.string().nullable()}).merge(R),ne=({parentCategoryId:t})=>{var v,b;const{t:a}=M(),{handleSuccess:r}=ee(),[o,d]=j.useState("details"),[g,w]=j.useState(!1),[N,p]=j.useState(!1),n=W({defaultValues:{name:"",description:"",handle:"",status:"active",visibility:"public",rank:t?0:null,parent_category_id:t},resolver:q(re)}),h=u=>{if(u==="organize"){const{name:F,handle:I,description:k,status:D,visibility:E}=n.getValues(),y=R.safeParse({name:F,handle:I,description:k,status:D,visibility:E});if(!y.success){y.error.errors.forEach(C=>{n.setError(C.path.join("."),{type:"manual",message:C.message})});return}n.clearErrors(),w(!0)}d(u)},{mutateAsync:f,isPending:S}=G(),T=n.handleSubmit(u=>{const{visibility:F,status:I,parent_category_id:k,rank:D,name:E,...y}=u,C=Y(y,!1);p(!0),f({name:E,...C,parent_category_id:k??void 0,rank:D??void 0,is_active:I==="active",is_internal:F==="internal"},{onSuccess:({product_category:_})=>{H.success(a("categories.create.successToast",{name:_.name})),r(`/categories/${_.id}`)},onError:_=>{H.error(_.message),p(!1)}})}),z=(v=n.getFieldState("parent_category_id"))!=null&&v.isDirty||(b=n.getFieldState("rank"))!=null&&b.isDirty||o==="organize"?"in-progress":"not-started",l=g?"completed":"in-progress";return e.jsx(x.Form,{form:n,children:e.jsx(Z,{onSubmit:T,className:"flex size-full flex-col overflow-hidden",children:e.jsxs(m,{value:o,onValueChange:u=>h(u),className:"flex size-full flex-col",children:[e.jsx(x.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(m.List,{className:"grid w-full grid-cols-2",children:[e.jsx(m.Trigger,{value:"details",status:l,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:a("categories.create.tabs.details")})}),e.jsx(m.Trigger,{value:"organize",status:z,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:a("categories.create.tabs.organize")})})]})})})}),e.jsxs(x.Body,{className:"flex size-full flex-col overflow-auto",children:[e.jsx(m.Content,{value:"details",children:e.jsx(ae,{form:n})}),e.jsx(m.Content,{value:"organize",className:"bg-ui-bg-subtle flex-1",children:e.jsx(te,{form:n,shouldFreeze:N})})]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(V,{size:"small",variant:"secondary",children:a("actions.cancel")})}),o==="organize"?e.jsx(V,{size:"small",variant:"primary",type:"submit",isLoading:S,children:a("actions.save")},"submit-btn"):e.jsx(V,{size:"small",variant:"primary",type:"button",onClick:()=>h("organize"),children:a("actions.continue")},"continue-btn")]})})]})})})},be=()=>{const[t]=K(),a=t.get("parent_category_id");return e.jsx(x,{children:e.jsx(ne,{parentCategoryId:a})})};export{be as Component};
